#summary jallib style guide, a recipe to write a standard jalv2 library
#labels Phase-Implementation

The *jallib style guide* defines the standards used to write jalv2 code. 

= Why ? =

There're many ways to write code, whatever the programming language is. Each language has its preferences. For instance, java prefers _CamelCase_ _whereas python prefers _underscore_lowercase_.

While this seems a real constraint, not necessarily needed, it actually helps a lot while sharing code with everyone: it improves *readability*, and readability is important because code is read much more often than it is written.

Finally, more than a howto write code, this guide is here to help you not forget things like _author(s)_, _licence_, and remember you some basic principles.


= Headers in library =

Every jal files published on this repository must have the following headers (comments), as the very beginning of the file:
 
{{{
-- [Title, small description]
-- Copyright (c) YEAR..YEAR, [author's name]
-- Adapted by: [adapter's name]
-- Compiler: [specify which version of compiler is needed. Ex: >= 2.4g, =2.3, ???]
-- 
-- This file is part of jallib (http://jallib.googlecode.com)
-- Released under the BSD license (http://www.opensource.org/licenses/bsd-license.php)
--
--

[code start here...]
}}}

The *author* is the original author's name. The library may have been modified and adapted by *adapters*. The *compiler* helps readers to know which compiler version is needed to use this file.

Example:

{{{
-- serial_hardware.jal, USART hardware control
-- Copyright (c) 2002..2006 Stef Mientki
-- Adapted by: Some One
-- Compiler: >= 2.3
-- 
-- This file is part of jallib (http://jallib.googlecode.com)
-- Released under the BSD license (http://www.opensource.org/licenses/bsd-license.php)
--
--
}}}


= Rules of thumb =

== Don't use pin names ==

*Don't use pin names* like `pin_a5` in your great library, because someone may (will) want to use your great library on another pin. It also helps your great library to be PIC independent.

*Name your pins according to the context*, to what your library is doing. Client code, ie. users, will have to define those variables before actually include your great library.

Ex: how to use your library (doing amazing things with the GP2D02 IR ranger)
{{{
-- defines in/out pins for the ranger
var volatile bit ranger_pin_in is pin_a0
var volatile bit ranger_pin_out is pin_a1
pin_a1_direction = input
pin_a0_direction = output

include gp2d02 -- your library uses ranger_pin_in and ranger_pin_out
-- your library 
}}}

_Exception_: if your library uses a special PIC feature, it may use the name defined in the device files / datasheet. Not so much an exception, as you'll use the pin name given the context (feature, peripheral)

Ex: a i2c hardware library (using built-in PIC i2c) may refer to `SCK` and `SDA`. Those pin names are set into the device include file.

== Avoid weird default values in library ==

*Don't put default values* in your library, someone may (will) have a different opinion about what's a _default value_. Even if it's tempting because it can save time writing the same value again and again. Remember, your library is to be shared, nasty default value can be a real obstacle using it...

== Write examples ==

*Write examples* to show the world how to use your great library. Without it, people may (will) not use your library, because it's too complicated and time-consuming reading code to actually discover what it does. Also remember writing examples can help _you_ to design a usable, simple and clear API. 


== Assembler ==

If you want to write assembler, please use *standard asm statement*, avoid nasty asm statements. So:


*Good*
{{{
btfsc STATUS_Z
}}}
   
*Bad*
{{{
skpnz
}}}

   


= Code Layout =

== Indent your code ==

It helps following the code structure (flows).

*Good*
{{{
var byte char
forever loop
    if serial_hw_read(char) then
        echo(char)
    end if
end loop
}}}

*Bad*
{{{
var byte char
forever loop
if serial_hw_read(char) then
echo(char)
end if
end loop
}}}

== Use lower_case_with_underscores ... ==

*Good*
{{{
var byte this_is_a_variable
var byte another_one
}}}

*Bad*
{{{
var byte ThisIsAVariable
var byte Another_One
}}}

== ... except for constants ==

*Good*
{{{
const RESET_CHAR = "*"
}}}

*Bad*
{{{
const reset_CHAR = "*"

}}}


DISCUSS: uppercase variables should be used for internal PIC function registers of for external PIN names, if they are uppercase in the datasheet as well.

== Inform readers what should be considered private ==

Functions, procedures, variables, etc... starting with an underscore is warning
to users saying "you shouldn't use me, I'm for internal use only". Play carefully with this, remember users are quite curious and may want them anyway :)

== Comment your code ==

It helps readers understand what's going on.
The comment should describe *why* your code does its thing, not what is does. That should be obvious from the code itself. 