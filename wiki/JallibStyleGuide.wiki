#summary jallib style guide, a recipe to write a standard jalv2 library
#labels Phase-Implementation

The *jallib style guide* defines the standards used to write jalv2 code. 

= Why ? =

There're many ways to write code, whatever the programming language is. Each language has its preferences. For instance, java prefers _CamelCase_ _whereas python prefers _underscore_lowercase_.

While this seems a real constraint, not necessarily needed, it actually helps a lot while sharing code with everyone: it improves *readability*, and readability is important because code is read much more often than it is written.

Finally, more than a howto write code, this guide is here to help you not forget things like _author(s)_, _licence_, and remember you some basic principles.


= Headers in library =



= Basic principles =

= Code Layout =

== Indent your code ==

It helps following the code structure (flows).

*Good*
{{{
var byte char
forever loop
    if serial_hw_read(char) then
        echo(char)
    end if
end loop
}}}

*Bad*
{{{
var byte char
forever loop
if serial_hw_read(char) then
echo(char)
end if
end loop
}}}

== Use lower_case_with_underscores ... ==

*Good*
{{{
var byte this_is_a_variable
var byte another_one
}}}

*Bad*
{{{
var byte ThisIsAVariable
var byte Another_One
}}}

== ... except for constants ==

*Good*
{{{
const RESET_CHAR = "*"
}}}

*Bad*
{{{
const reset_CHAR = "*"

}}}


DISCUSS: uppercase variables should be used for internal PIC function registers of for external PIN names, if they are uppercase in the datasheet as well.

== Inform readers what should be considered private ==

Functions, procedures, variables, etc... starting with an underscore is warning
to users saying "you shouldn't use me, I'm for internal use only". Play carefully with this, remember users are quite curious and may want them anyway :)

== Comment your code ==

It helps readers understand what's going on.
The comment should describe *why* your code does its thing, not what is does. That should be obvious from the code itself. 


= Library structure =


== Device File ==

The device file is (preferably) automatically generated from a Microchip INC file and contains information about all ports and special function registers.

It lists the various configuration settings. 

Proposed name: `picxxfyyyy_dev.jal` (at least for a flash PIC)

== Init File == 

-FIXME:
How do we call the file which sets the clock speed, analog functions, etc? 
Init library?  `picxxfyyyy_init.jal`

By default, the init file makes all pins digital IO and sets a standard xtal speed.


== Super Lib ==

The superlib includes all possible hardware libraries that are used on the PIC and sets the default needed parameters for these libs. It also includes paramaters that have a defualt setting in the library, so need not be declared by the user, in comments, with the default value. Example:
 

{{{
const baudrate = 2400

-- const nine_bit_tx    = false
-- const nine_bit_rx    = false
-- const synchronous = false


include serial_hardware_16


const SPI_mode  = true
const master    = true

-- const clock_polarity_idle_high = true

include SPI

const I2C_mode = false              -- both SPI and I2C can't be enabled

include I2C
}}}  



Since the hardware libs have their default values, direct messing with configuration bits in special function regs should happen after including the lib.  



